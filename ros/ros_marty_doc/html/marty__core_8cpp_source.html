<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>ros_marty: marty_core.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_51d6616cce93a5023f92fa2f16639b7c.html">ros_marty</a></li><li class="navelem"><a class="el" href="dir_47c2952e4473bffb0fea7e90ba27b3b0.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">marty_core.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="marty__core_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="marty__core_8hpp.html">ros_marty/marty_core.hpp</a>&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno"><a class="line" href="classMartyCore.html#a90c78210333e09fc2b2fa30b435f492e">   11</a></span>&#160;<a class="code" href="classMartyCore.html#a90c78210333e09fc2b2fa30b435f492e">MartyCore::MartyCore</a>(ros::NodeHandle&amp; nh) : nh_(nh), tf_ls_(tf_buff_) {</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  this-&gt;<a class="code" href="classMartyCore.html#a7d984d7fdf74ef81f23829c596949af4">loadParams</a>();</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  this-&gt;<a class="code" href="classMartyCore.html#af2ae942aed2014564c7ef4ff046f5266">init</a>();</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  this-&gt;<a class="code" href="classMartyCore.html#a622d785e9b07add001429d3e7af6ee60">rosSetup</a>();</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  ROS_INFO(<span class="stringliteral">&quot;MartyCore Ready!&quot;</span>);</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;}</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="classMartyCore.html#a710ab72c1b1a49ce08b705fcfb394758">   18</a></span>&#160;<a class="code" href="classMartyCore.html#a710ab72c1b1a49ce08b705fcfb394758">MartyCore::~MartyCore</a>() {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  ros::param::del(<span class="stringliteral">&quot;/marty&quot;</span>);</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.deleteParam(<span class="stringliteral">&quot;~&quot;</span>);</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="classMartyCore.html#a7d984d7fdf74ef81f23829c596949af4">   23</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a7d984d7fdf74ef81f23829c596949af4">MartyCore::loadParams</a>() {</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.param(<span class="stringliteral">&quot;calibrated&quot;</span>, <a class="code" href="classMartyCore.html#ac644846686545827cfbb0ff129d2ba0e">calibrated_</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classMartyCore.html#ac644846686545827cfbb0ff129d2ba0e">calibrated_</a>) {</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <a class="code" href="definitions_8hpp.html#a830e8fd7a64314a844902b690f4cda58">ERR</a>(<span class="stringliteral">&quot;Marty has not been calibrated before!\n&quot;</span>);</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <a class="code" href="definitions_8hpp.html#a0374cad637bd9df09182785b0c204658">WARN</a>(<span class="stringliteral">&quot;Please use &#39;roslaunch ros_marty calibration.launch&#39; to calibrate\n&quot;</span>);</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    ros::param::del(<span class="stringliteral">&quot;/marty&quot;</span>);</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.deleteParam(<span class="stringliteral">&quot;~&quot;</span>);</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    ros::shutdown();</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    exit(0);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  }</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <a class="code" href="definitions_8hpp.html#a0a9c281eff44a3c24d869735fedb0781ab24edcb61693657713c2e9299b34c539">NUMJOINTS</a>; ++id) {</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    std::string zero_p = <a class="code" href="definitions_8hpp.html#aba0d904fc027cae3c83978c277181f4e">NAMES</a>[id] + <span class="stringliteral">&quot;/zero&quot;</span>;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    std::string max_p = <a class="code" href="definitions_8hpp.html#aba0d904fc027cae3c83978c277181f4e">NAMES</a>[id] + <span class="stringliteral">&quot;/max&quot;</span>;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    std::string min_p = <a class="code" href="definitions_8hpp.html#aba0d904fc027cae3c83978c277181f4e">NAMES</a>[id] + <span class="stringliteral">&quot;/min&quot;</span>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    std::string dir_p = <a class="code" href="definitions_8hpp.html#aba0d904fc027cae3c83978c277181f4e">NAMES</a>[id] + <span class="stringliteral">&quot;/dir&quot;</span>;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    std::string mult_p = <a class="code" href="definitions_8hpp.html#aba0d904fc027cae3c83978c277181f4e">NAMES</a>[id] + <span class="stringliteral">&quot;/mult&quot;</span>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    ros::param::get(zero_p, <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[<span class="keywordtype">id</span>].cmdZero);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    ros::param::get(max_p, <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[<span class="keywordtype">id</span>].cmdMax);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    ros::param::get(min_p, <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[<span class="keywordtype">id</span>].cmdMin);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    ros::param::get(dir_p, <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[<span class="keywordtype">id</span>].cmdDir);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    ros::param::get(mult_p, <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[<span class="keywordtype">id</span>].cmdMult);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  }</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.param(<span class="stringliteral">&quot;check_fall&quot;</span>, <a class="code" href="classMartyCore.html#ad3d16ea1a8bf2cdaafd368b48e494a1c">fall_disable_</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.param(<span class="stringliteral">&quot;fall_threshold&quot;</span>, <a class="code" href="classMartyCore.html#a70698111743c869bd81d2060cdf7cb94">fall_thr_</a>, 0.9);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.param(<span class="stringliteral">&quot;odom_accel&quot;</span>, <a class="code" href="classMartyCore.html#a0831959359817e2091dd77655ee8786d">odom_accel_</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.param(<span class="stringliteral">&quot;camera&quot;</span>, <a class="code" href="classMartyCore.html#a9e6b5e5dec6b2ee889c7286ec5a92368">camera_</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classMartyCore.html#a9e6b5e5dec6b2ee889c7286ec5a92368">camera_</a>) {<a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.param(<span class="stringliteral">&quot;camera_ori&quot;</span>, <a class="code" href="classMartyCore.html#a8d373cff0b0fc4516b785e1084738793">camera_ori_</a>, 15.0);}</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.param(<span class="stringliteral">&quot;simulated&quot;</span>, <a class="code" href="classMartyCore.html#a97403bfc03ee9e4e7720bab246b0672b">simulated_</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classMartyCore.html#a97403bfc03ee9e4e7720bab246b0672b">simulated_</a>) { ROS_WARN(<span class="stringliteral">&quot;Marty is being simulated&quot;</span>); }</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  marty_msgs::ServoMsg joint;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <a class="code" href="definitions_8hpp.html#a0a9c281eff44a3c24d869735fedb0781ab24edcb61693657713c2e9299b34c539">NUMJOINTS</a>; ++id) {</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    joint.servo_id = id;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    joint.servo_cmd = <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[id].<a class="code" href="structrobotJoint.html#a59c532bd7710ffeee599810b7f533e7d">cmdZero</a>;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// servo_msg_array_.servo_msg.push_back(joint);</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  }</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="classMartyCore.html#af2ae942aed2014564c7ef4ff046f5266">   62</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#af2ae942aed2014564c7ef4ff046f5266">MartyCore::init</a>() {</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <a class="code" href="classMartyCore.html#a2771c0b4165fd4022717fdb057f5d40b">falling_</a>.data = <span class="keyword">false</span>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <a class="code" href="classMartyCore.html#a482d48aa2c5c2416cc57a872a11afc33">battery_max_</a> = 8.4;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <a class="code" href="classMartyCore.html#ae58a40e24bd1f3afbc121bdb9b9ae941">battery_min_</a> = 6.8;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <a class="code" href="classMartyCore.html#a3511e234a07c60ce506430553631e1ac">odom_setup_</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ji = 0; ji &lt; <a class="code" href="definitions_8hpp.html#a0a9c281eff44a3c24d869735fedb0781ab24edcb61693657713c2e9299b34c539">NUMJOINTS</a>; ji++) { <a class="code" href="classMartyCore.html#abe0ff63291fd97b0536a510250f38868">jangles_</a>.push_back(0); }</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">// Camera TF</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classMartyCore.html#a9e6b5e5dec6b2ee889c7286ec5a92368">camera_</a>) {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="classMartyCore.html#aace8edc342f8cdcca08045db36218e1e">cam_tf_</a>.header.frame_id = <span class="stringliteral">&quot;base_link&quot;</span>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="classMartyCore.html#aace8edc342f8cdcca08045db36218e1e">cam_tf_</a>.child_frame_id = <span class="stringliteral">&quot;camera&quot;</span>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="classMartyCore.html#aace8edc342f8cdcca08045db36218e1e">cam_tf_</a>.transform.translation.x = 0.023;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="classMartyCore.html#aace8edc342f8cdcca08045db36218e1e">cam_tf_</a>.transform.translation.y = 0.0;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <a class="code" href="classMartyCore.html#aace8edc342f8cdcca08045db36218e1e">cam_tf_</a>.transform.translation.z = 0.027;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// tf2::Quaternion q(-0.54168, 0.54168, -0.45452, 0.45452);</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// tf2::Quaternion q(-0.596, 0.596, -0.380, 0.380); // 25 deg</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    tf2::Quaternion q(-0.627, 0.627, -0.327, 0.327); <span class="comment">// 35 deg</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    q.normalize();</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="classMartyCore.html#aace8edc342f8cdcca08045db36218e1e">cam_tf_</a>.transform.rotation = tf2::toMsg(q);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// double ori = ((90 - camera_ori_) / 180) * M_PI;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// ROS_INFO_STREAM(&quot;CamOri: &quot; &lt;&lt; camera_ori_ &lt;&lt; &quot; ORI: &quot; &lt;&lt; ori &lt;&lt;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// &quot; PI: &quot; &lt;&lt; M_PI);</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// q.setRPY(-M_PI, ori, (M_PI / 2)); // TODO: This is borked</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// ROS_INFO_STREAM(&quot;X: &quot; &lt;&lt; q.x() &lt;&lt; &quot; Y: &quot; &lt;&lt; q.y() &lt;&lt;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">//                 &quot; Z: &quot; &lt;&lt; q.z() &lt;&lt; &quot; W: &quot; &lt;&lt; q.w());</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// cam_tf_.transform.rotation.x = tf2::toMsg(q);</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">// Odom TF</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.header.frame_id = <span class="stringliteral">&quot;odom&quot;</span>;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.child_frame_id = <span class="stringliteral">&quot;base_link&quot;</span>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.transform.translation.x = 0;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.transform.translation.y = 0;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.transform.translation.z = 0;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.transform.rotation.x = 0;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.transform.rotation.y = 0;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.transform.rotation.z = 0;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.transform.rotation.w = 1;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  this-&gt;<a class="code" href="classMartyCore.html#ae50a753181398deb70477884f868b772">setupJointStates</a>();</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="classMartyCore.html#a622d785e9b07add001429d3e7af6ee60">  103</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a622d785e9b07add001429d3e7af6ee60">MartyCore::rosSetup</a>() {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// PUBLISHERS</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <a class="code" href="classMartyCore.html#a3b349c5b7db6f13f7df3695c05fc4bf5">enable_pub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.advertise&lt;std_msgs::Bool&gt;(<span class="stringliteral">&quot;enable_motors&quot;</span>, 10);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classMartyCore.html#a97403bfc03ee9e4e7720bab246b0672b">simulated_</a>) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="classMartyCore.html#a3b349c5b7db6f13f7df3695c05fc4bf5">enable_pub_</a>.getNumSubscribers() == 0) {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      ROS_INFO(<span class="stringliteral">&quot;Waiting for rosserial to start...\n&quot;</span>);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <a class="code" href="definitions_8hpp.html#a3a7b2585d8f81aa095ef413b539cfb18">sleepms</a>(500);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <a class="code" href="classMartyCore.html#a9a67293317df40afa0e29b0f3a6d97f6">falling_pub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.advertise&lt;std_msgs::Bool&gt;(<span class="stringliteral">&quot;falling&quot;</span>, 1, <span class="keyword">true</span>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <a class="code" href="classMartyCore.html#aa50e0c51c26d4c5ef5e3c2afe419ad8b">servo_pub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.advertise&lt;marty_msgs::ServoMsg&gt;(<span class="stringliteral">&quot;servo&quot;</span>, 10);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="classMartyCore.html#a22fba082d2cb7bb78a1d2f108aa3e25c">servo_array_pub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.advertise&lt;marty_msgs::ServoMsgArray&gt;(<span class="stringliteral">&quot;servo_array&quot;</span>, 10);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="classMartyCore.html#ac3ee562efa2d9947fe52fa6e41882e46">joints_pub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.advertise&lt;sensor_msgs::JointState&gt;(<span class="stringliteral">&quot;joint_states&quot;</span>, 10);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <a class="code" href="classMartyCore.html#ab3d4002b1add339bd53373ea115a544f">sound_pub_</a> =  <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.advertise&lt;marty_msgs::SoundArray&gt;(<span class="stringliteral">&quot;sound&quot;</span>, 10);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <a class="code" href="classMartyCore.html#af65a15e9e21bfaeb740c156f27a70620">keyframe_pub_</a> =  <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.advertise&lt;marty_msgs::KeyframeArray&gt;(<span class="stringliteral">&quot;keyframes&quot;</span>, 10);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">// SUBSCRIBERS</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="classMartyCore.html#ae06f951948eac84ba0b33ace95b90eb8">joint_sub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.subscribe(<span class="stringliteral">&quot;servo&quot;</span>, 1000, &amp;<a class="code" href="classMartyCore.html#aa0027c4e6584c1b0db6295216b93d919">MartyCore::jointCB</a>, <span class="keyword">this</span>);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="classMartyCore.html#a1b9fc2545c5e69fa6d0a957cae3db884">joints_sub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.subscribe(<span class="stringliteral">&quot;servo_array&quot;</span>, 1000, &amp;<a class="code" href="classMartyCore.html#adc2b3c6b57e48bdd03831d1d33f3ed8c">MartyCore::jointsCB</a>, <span class="keyword">this</span>);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <a class="code" href="classMartyCore.html#a085191b257663749e7914d39bad0b17b">accel_sub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.subscribe(<span class="stringliteral">&quot;accel&quot;</span>, 1000, &amp;<a class="code" href="classMartyCore.html#a1257013e79001c4bb7386ade675ed880">MartyCore::accelCB</a>, <span class="keyword">this</span>);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <a class="code" href="classMartyCore.html#ab33c93f4a6092943aa806b916da79024">batt_sub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.subscribe(<span class="stringliteral">&quot;battery&quot;</span>, 1000, &amp;<a class="code" href="classMartyCore.html#ac18a5847558bf4d8811eb2d7e171bda0">MartyCore::battCB</a>, <span class="keyword">this</span>);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <a class="code" href="classMartyCore.html#ace7942c9f2f0467b9c6daf246c7fa5dd">gpio_sub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.subscribe(<span class="stringliteral">&quot;gpios&quot;</span>, 1000, &amp;<a class="code" href="classMartyCore.html#ada2c86bdec6f1e3ffcf0614853663fb2">MartyCore::gpioCB</a>, <span class="keyword">this</span>);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <a class="code" href="classMartyCore.html#a0ddba4390f6f72838371329f8930b5d1">sound_sub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.subscribe(<span class="stringliteral">&quot;sound_file&quot;</span>, 1000, &amp;<a class="code" href="classMartyCore.html#aea46deb1912ea3c7016513ac87e1bb6a">MartyCore::soundCB</a>, <span class="keyword">this</span>);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <a class="code" href="classMartyCore.html#a730729a9e6d909aa7fc74753a969ca85">keyframe_sub_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.subscribe(<span class="stringliteral">&quot;keyframe_file&quot;</span>, 1000, &amp;<a class="code" href="classMartyCore.html#ada9568d3e37b1ddb430ea3de6ed19d42">MartyCore::kfCB</a>, <span class="keyword">this</span>);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// SERVICES</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="classMartyCore.html#a6ed602bfc9baa24621d794976a8c3369">fall_dis_srv_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.advertiseService(<span class="stringliteral">&quot;fall_disable&quot;</span>,</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                                       &amp;<a class="code" href="classMartyCore.html#a969c290f3d5ade57a90f7c2aadf875e6">MartyCore::setFallDetector</a>, <span class="keyword">this</span>);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">// ros::service::waitForService(&quot;set_gpio_config&quot;);</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// set_gpio_config_ =</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">//   nh_.serviceClient&lt;marty_msgs::GPIOConfig&gt;(&quot;set_gpio_config&quot;);</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="comment">// ros::service::waitForService(&quot;get_gpio_config&quot;);</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// get_gpio_config_ =</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">//   nh_.serviceClient&lt;marty_msgs::GPIOConfig&gt;(&quot;get_gpio_config&quot;);</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">// marty_msgs::GPIOConfig srv;</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">// srv.request.config[0] = marty_msgs::GPIOConfig::Request::DIGITAL_IN;</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">// if (set_gpio_config_.call(srv)) {</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">//   if (srv.response.success) {ROS_INFO(&quot;SUCCESS!&quot;);} else {ROS_WARN(&quot;NAY!&quot;);}</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">// } else { ROS_ERROR(&quot;Failed to call set gpio service!&quot;); }</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// TIMERS</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="classMartyCore.html#af9b5e13dd3179bd4c14a37f682fc8ea0">tf_timer_</a> = <a class="code" href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">nh_</a>.createTimer(ros::Duration(0.1), &amp;<a class="code" href="classMartyCore.html#a1ba0bea97457c3cb514c462fcf81a3eb">MartyCore::tfCB</a>, <span class="keyword">this</span>);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;}</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="classMartyCore.html#a969c290f3d5ade57a90f7c2aadf875e6">  144</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classMartyCore.html#a969c290f3d5ade57a90f7c2aadf875e6">MartyCore::setFallDetector</a>(std_srvs::SetBool::Request&amp; req,</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                                std_srvs::SetBool::Response&amp; res) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <a class="code" href="classMartyCore.html#ad3d16ea1a8bf2cdaafd368b48e494a1c">fall_disable_</a> = req.data; res.success = <span class="keyword">true</span>; <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;}</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="classMartyCore.html#ae50a753181398deb70477884f868b772">  149</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#ae50a753181398deb70477884f868b772">MartyCore::setupJointStates</a>() {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;face_joint&quot;</span>);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_arm_servo_gear_joint&quot;</span>);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_arm_gear_joint&quot;</span>);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_arm_servo_gear_joint&quot;</span>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_arm_gear_joint&quot;</span>);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_eye_joint&quot;</span>);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_eye_joint&quot;</span>);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_hip_link1_joint&quot;</span>);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_hip_link2_joint&quot;</span>);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_hip_link3_joint&quot;</span>);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_hip_servo_link_joint&quot;</span>);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_twist_servo_holder1_joint&quot;</span>);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_twist_shaft_joint&quot;</span>);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_knee_link1_joint&quot;</span>);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_knee_link2_joint&quot;</span>);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_knee_link3_joint&quot;</span>);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_knee_servo_link_joint&quot;</span>);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;left_foot_joint&quot;</span>);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_hip_link1_joint&quot;</span>);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_hip_link2_joint&quot;</span>);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_hip_link3_joint&quot;</span>);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_hip_servo_link_joint&quot;</span>);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_twist_servo_holder1_joint&quot;</span>);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_twist_shaft_joint&quot;</span>);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_knee_link1_joint&quot;</span>);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_knee_link2_joint&quot;</span>);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_knee_link3_joint&quot;</span>);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_knee_servo_link_joint&quot;</span>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.push_back(<span class="stringliteral">&quot;right_foot_joint&quot;</span>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.name.size(); ++j) {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position.push_back(0.0);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="classMartyCore.html#a49d020abd66e2cdf04ff1286ec91aaec">  184</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a49d020abd66e2cdf04ff1286ec91aaec">MartyCore::setupOdometry</a>() {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordflow">try</span> {   <span class="comment">// Wait until transformation data from feet is received</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a> = <a class="code" href="classMartyCore.html#ab28ec1b5b94312417bb4c89fc3b609f4">tf_buff_</a>.lookupTransform(<span class="stringliteral">&quot;base_link&quot;</span>, <span class="stringliteral">&quot;left_foot&quot;</span>, ros::Time(0));</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a> = <a class="code" href="classMartyCore.html#ab28ec1b5b94312417bb4c89fc3b609f4">tf_buff_</a>.lookupTransform(<span class="stringliteral">&quot;base_link&quot;</span>, <span class="stringliteral">&quot;right_foot&quot;</span>, ros::Time(0));</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="classMartyCore.html#a3511e234a07c60ce506430553631e1ac">odom_setup_</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  } <span class="keywordflow">catch</span> (tf2::TransformException&amp; ex) { ROS_WARN(<span class="stringliteral">&quot;%s&quot;</span>, ex.what()); }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="classMartyCore.html#aa0027c4e6584c1b0db6295216b93d919">  192</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#aa0027c4e6584c1b0db6295216b93d919">MartyCore::jointCB</a>(<span class="keyword">const</span> marty_msgs::ServoMsg::ConstPtr&amp; msg) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  this-&gt;<a class="code" href="classMartyCore.html#a4112ff7fbbda7e868e095f8eac226c58">updateJointState</a>(*msg);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;}</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="classMartyCore.html#adc2b3c6b57e48bdd03831d1d33f3ed8c">  196</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#adc2b3c6b57e48bdd03831d1d33f3ed8c">MartyCore::jointsCB</a>(<span class="keyword">const</span> marty_msgs::ServoMsgArray::ConstPtr&amp; msg) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; msg-&gt;servo_msg.size(); ++id) {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    this-&gt;<a class="code" href="classMartyCore.html#a4112ff7fbbda7e868e095f8eac226c58">updateJointState</a>(msg-&gt;servo_msg[<span class="keywordtype">id</span>]);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;}</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="classMartyCore.html#a3355cd1d38cff41b1548915bb698bac4">  202</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classMartyCore.html#a3355cd1d38cff41b1548915bb698bac4">MartyCore::getBattery</a>() {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordtype">float</span> percentage = (<a class="code" href="classMartyCore.html#a7462781d92ba61c2d7f913e88a177d26">battery_val_</a> - <a class="code" href="classMartyCore.html#ae58a40e24bd1f3afbc121bdb9b9ae941">battery_min_</a>) /</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                     (<a class="code" href="classMartyCore.html#a482d48aa2c5c2416cc57a872a11afc33">battery_max_</a> - <a class="code" href="classMartyCore.html#ae58a40e24bd1f3afbc121bdb9b9ae941">battery_min_</a>);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">return</span> percentage;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno"><a class="line" href="classMartyCore.html#a4112ff7fbbda7e868e095f8eac226c58">  215</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a4112ff7fbbda7e868e095f8eac226c58">MartyCore::updateJointState</a>(marty_msgs::ServoMsg servo) {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordflow">if</span> (servo.servo_id == 0) {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[10] =</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      ( (float)servo.servo_cmd - <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[0].<a class="code" href="structrobotJoint.html#a59c532bd7710ffeee599810b7f533e7d">cmdZero</a> ) / 123.3;     <span class="comment">// LHIP</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[7] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[10];                   <span class="comment">// LHIP1</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[8] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[10];                   <span class="comment">// LHIP2</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[9] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[10];                   <span class="comment">// LHIP3</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[11] = -<a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[10];                 <span class="comment">// LKNEEBox</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (servo.servo_id == 1) {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[12] =</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      -( (float)servo.servo_cmd - <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[1].<a class="code" href="structrobotJoint.html#a59c532bd7710ffeee599810b7f533e7d">cmdZero</a> ) / 123.3;    <span class="comment">// LTWIST</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (servo.servo_id == 2) {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[16] =</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      -( (float)servo.servo_cmd - <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[2].<a class="code" href="structrobotJoint.html#a59c532bd7710ffeee599810b7f533e7d">cmdZero</a> ) / 123.3;    <span class="comment">// LKNEE</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[13] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[16];                  <span class="comment">// LKNEE1</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[14] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[16];                  <span class="comment">// LKNEE2</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[15] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[16];                  <span class="comment">// LKNEE3</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[17] = -<a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[16];                 <span class="comment">// LFOOT</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (servo.servo_id == 3) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[21] =</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      ( (float)servo.servo_cmd - <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[3].<a class="code" href="structrobotJoint.html#a59c532bd7710ffeee599810b7f533e7d">cmdZero</a> ) / 123.3;     <span class="comment">// RHIP</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[18] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[21];                  <span class="comment">// RHIP1</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[19] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[21];                  <span class="comment">// RHIP2</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[20] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[21];                  <span class="comment">// RHIP3</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[22] = -<a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[21];                 <span class="comment">// RKNEEBox</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (servo.servo_id == 4) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[23] =</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      -( (float)servo.servo_cmd - <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[4].<a class="code" href="structrobotJoint.html#a59c532bd7710ffeee599810b7f533e7d">cmdZero</a> ) / 123.3;    <span class="comment">// RTWIST</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (servo.servo_id == 5) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[27] =</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      -( (float)servo.servo_cmd - <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[5].<a class="code" href="structrobotJoint.html#a59c532bd7710ffeee599810b7f533e7d">cmdZero</a> ) / 123.3;    <span class="comment">// RKNEE</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[24] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[27];                  <span class="comment">// RKNEE1</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[25] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[27];                  <span class="comment">// RKNEE2</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[26] = <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[27];                  <span class="comment">// RKNEE3</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[28] = -<a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[27];                 <span class="comment">// RFOOT</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (servo.servo_id == 6) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[1] =</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      ( (float)servo.servo_cmd - <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[6].<a class="code" href="structrobotJoint.html#a59c532bd7710ffeee599810b7f533e7d">cmdZero</a> ) / 123.3;     <span class="comment">// LARM-Gear</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[2] = -<a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[1] * 1.1875;          <span class="comment">// LARM</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (servo.servo_id == 7) {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[3] =</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      ( (float)servo.servo_cmd - <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[7].<a class="code" href="structrobotJoint.html#a59c532bd7710ffeee599810b7f533e7d">cmdZero</a> ) / 123.3;     <span class="comment">// RARM-Gear</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[4] = -<a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[3] * 1.1875;          <span class="comment">// RARM</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (servo.servo_id == 8) {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[6] =</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      ( (float)servo.servo_cmd - <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[8].<a class="code" href="structrobotJoint.html#a59c532bd7710ffeee599810b7f533e7d">cmdZero</a> ) / 123.3;     <span class="comment">// EYE-Left</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[5] = -<a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.position[6];                   <span class="comment">// EYE-Right</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;}</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="classMartyCore.html#a1257013e79001c4bb7386ade675ed880">  276</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a1257013e79001c4bb7386ade675ed880">MartyCore::accelCB</a>(<span class="keyword">const</span> marty_msgs::Accelerometer::ConstPtr&amp; msg) {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <a class="code" href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">accel_</a> = *msg;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="comment">// Check if Robot is falling</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">accel_</a>.y &lt; <a class="code" href="classMartyCore.html#a70698111743c869bd81d2060cdf7cb94">fall_thr_</a>) &amp;&amp; (<a class="code" href="classMartyCore.html#a2771c0b4165fd4022717fdb057f5d40b">falling_</a>.data == <span class="keyword">false</span>)) {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    ROS_WARN_STREAM(<span class="stringliteral">&quot;Robot Falling! &quot;</span> &lt;&lt; <a class="code" href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">accel_</a>.y &lt;&lt; std::endl);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="classMartyCore.html#a2771c0b4165fd4022717fdb057f5d40b">falling_</a>.data = <span class="keyword">true</span>;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classMartyCore.html#ad3d16ea1a8bf2cdaafd368b48e494a1c">fall_disable_</a>) {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <a class="code" href="classMartyCore.html#a87e8f70a443141aec8c53599af660f12">enable_robot_</a>.data = <span class="keyword">false</span>; <a class="code" href="classMartyCore.html#a3b349c5b7db6f13f7df3695c05fc4bf5">enable_pub_</a>.publish(<a class="code" href="classMartyCore.html#a87e8f70a443141aec8c53599af660f12">enable_robot_</a>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="classMartyCore.html#a9a67293317df40afa0e29b0f3a6d97f6">falling_pub_</a>.publish(<a class="code" href="classMartyCore.html#a2771c0b4165fd4022717fdb057f5d40b">falling_</a>);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">accel_</a>.y &gt; <a class="code" href="classMartyCore.html#a70698111743c869bd81d2060cdf7cb94">fall_thr_</a>) &amp;&amp; (<a class="code" href="classMartyCore.html#a2771c0b4165fd4022717fdb057f5d40b">falling_</a>.data == <span class="keyword">true</span>)) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    ROS_WARN_STREAM(<span class="stringliteral">&quot;Robot Stable! &quot;</span> &lt;&lt; <a class="code" href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">accel_</a>.y &lt;&lt; std::endl);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <a class="code" href="classMartyCore.html#a2771c0b4165fd4022717fdb057f5d40b">falling_</a>.data = <span class="keyword">false</span>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classMartyCore.html#ad3d16ea1a8bf2cdaafd368b48e494a1c">fall_disable_</a>) {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <a class="code" href="classMartyCore.html#a87e8f70a443141aec8c53599af660f12">enable_robot_</a>.data = <span class="keyword">true</span>; <a class="code" href="classMartyCore.html#a3b349c5b7db6f13f7df3695c05fc4bf5">enable_pub_</a>.publish(<a class="code" href="classMartyCore.html#a87e8f70a443141aec8c53599af660f12">enable_robot_</a>);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="classMartyCore.html#a9a67293317df40afa0e29b0f3a6d97f6">falling_pub_</a>.publish(<a class="code" href="classMartyCore.html#a2771c0b4165fd4022717fdb057f5d40b">falling_</a>);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">// Obtain Roll, Pitch and Yaw angles from accelerometer data</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordtype">double</span> roll = atan2(<a class="code" href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">accel_</a>.y, <a class="code" href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">accel_</a>.x) - 1.57;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordtype">double</span> pitch = atan2(<a class="code" href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">accel_</a>.y, <a class="code" href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">accel_</a>.z) - 1.57;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordtype">double</span> yaw = atan2(<a class="code" href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">accel_</a>.z, <a class="code" href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">accel_</a>.x);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="comment">// Perform moving window average to filter accelerator noise</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <a class="code" href="classMartyCore.html#a622ac5d29c8e0bc5ad96b15a72befe0a">roll_</a>.push_front(roll); <a class="code" href="classMartyCore.html#a3c07f4cb0be587e3f6c04ed0808e2bb4">pitch_</a>.push_front(pitch); <a class="code" href="classMartyCore.html#a84e5c247edc904e7fe0095baafd982f3">yaw_</a>.push_front(yaw);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordtype">int</span> s = <a class="code" href="classMartyCore.html#a622ac5d29c8e0bc5ad96b15a72befe0a">roll_</a>.size();</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; s; ++i) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    roll += <a class="code" href="classMartyCore.html#a622ac5d29c8e0bc5ad96b15a72befe0a">roll_</a>[i]; pitch += <a class="code" href="classMartyCore.html#a3c07f4cb0be587e3f6c04ed0808e2bb4">pitch_</a>[i]; yaw += <a class="code" href="classMartyCore.html#a84e5c247edc904e7fe0095baafd982f3">yaw_</a>[i];</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  roll = roll / s; pitch = pitch / s; yaw = yaw / s;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <a class="code" href="classMartyCore.html#a622ac5d29c8e0bc5ad96b15a72befe0a">roll_</a>.resize(3); <a class="code" href="classMartyCore.html#a3c07f4cb0be587e3f6c04ed0808e2bb4">pitch_</a>.resize(3); <a class="code" href="classMartyCore.html#a84e5c247edc904e7fe0095baafd982f3">yaw_</a>.resize(3);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <a class="code" href="classMartyCore.html#a960fa5065af2a989b7f39490a47b26e9">r_</a> = roll; <a class="code" href="classMartyCore.html#a832e744ed239de665b785622da4336fa">p_</a> = -pitch;   <span class="comment">// Yaw discarded due to gimbal lock</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;}</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno"><a class="line" href="classMartyCore.html#ac18a5847558bf4d8811eb2d7e171bda0">  310</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#ac18a5847558bf4d8811eb2d7e171bda0">MartyCore::battCB</a>(<span class="keyword">const</span> std_msgs::Float32::ConstPtr&amp; msg) {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="classMartyCore.html#a7462781d92ba61c2d7f913e88a177d26">battery_val_</a> = msg-&gt;data;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="classMartyCore.html#ada2c86bdec6f1e3ffcf0614853663fb2">  314</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#ada2c86bdec6f1e3ffcf0614853663fb2">MartyCore::gpioCB</a>(<span class="keyword">const</span> marty_msgs::GPIOs::ConstPtr&amp; msg) {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <a class="code" href="classMartyCore.html#a981ceda4f125a5f5f3ec44f5c5f30e1b">gpios_val_</a> = *msg;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;}</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="classMartyCore.html#a12582aea20cab6ff1e6290d64fd817f7">  324</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a12582aea20cab6ff1e6290d64fd817f7">MartyCore::updateOdom</a>() {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classMartyCore.html#a3511e234a07c60ce506430553631e1ac">odom_setup_</a>) {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    this-&gt;<a class="code" href="classMartyCore.html#a49d020abd66e2cdf04ff1286ec91aaec">setupOdometry</a>();</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    geometry_msgs::TransformStamped l_f_tf, r_f_tf; <span class="comment">// Left/Right Foot TFs</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    geometry_msgs::Transform tf_diff;  <span class="comment">// TF change between time frames</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordtype">double</span> dy;  <span class="comment">// Yaw change from previous timestep</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// Initialise transformations</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    tf_diff.translation.x = tf_diff.translation.y = tf_diff.translation.z = 0;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    tf_diff.rotation.x = tf_diff.rotation.y = tf_diff.rotation.z = 0;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    tf_diff.rotation.w = 1;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    l_f_tf.transform = r_f_tf.transform = tf_diff;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">try</span> {   <span class="comment">// Acquire latest feet transformation data</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      l_f_tf = <a class="code" href="classMartyCore.html#ab28ec1b5b94312417bb4c89fc3b609f4">tf_buff_</a>.lookupTransform(<span class="stringliteral">&quot;base_link&quot;</span>, <span class="stringliteral">&quot;left_foot&quot;</span>, ros::Time(0));</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      r_f_tf = <a class="code" href="classMartyCore.html#ab28ec1b5b94312417bb4c89fc3b609f4">tf_buff_</a>.lookupTransform(<span class="stringliteral">&quot;base_link&quot;</span>, <span class="stringliteral">&quot;right_foot&quot;</span>, ros::Time(0));</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    } <span class="keywordflow">catch</span> (tf2::TransformException&amp; ex) { ROS_WARN(<span class="stringliteral">&quot;%s&quot;</span>, ex.what()); }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// Calculate feet previous and current roll, pitch, yaw orientations</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordtype">double</span> rql_, pql_, yql_, rql, pql, yql, rqr_, pqr_, yqr_, rqr, pqr, yqr;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    tf2::Quaternion ql_(<a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a>.transform.rotation.x, <a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a>.transform.rotation.y,</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                        <a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a>.transform.rotation.z, <a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a>.transform.rotation.w);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    ql_.normalize(); tf2::Matrix3x3(ql_).getRPY(rql_, pql_, yql_);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    tf2::Quaternion ql(l_f_tf.transform.rotation.x, l_f_tf.transform.rotation.y,</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                       l_f_tf.transform.rotation.z, l_f_tf.transform.rotation.w);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    ql.normalize(); tf2::Matrix3x3(ql).getRPY(rql, pql, yql);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    tf2::Quaternion qr_(<a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a>.transform.rotation.x, <a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a>.transform.rotation.y,</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                        <a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a>.transform.rotation.z, <a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a>.transform.rotation.w);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    qr_.normalize(); tf2::Matrix3x3(qr_).getRPY(rqr_, pqr_, yqr_);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    tf2::Quaternion qr(r_f_tf.transform.rotation.x, r_f_tf.transform.rotation.y,</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                       r_f_tf.transform.rotation.z, r_f_tf.transform.rotation.w);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    qr.normalize(); tf2::Matrix3x3(qr).getRPY(rqr, pqr, yqr);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">// Compute change in Translation and Yaw given foot on ground</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span> (l_f_tf.transform.translation.z &lt; r_f_tf.transform.translation.z) {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      dy = yql_ - yql; <span class="comment">// Left Foot Down</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      tf_diff.translation.x =</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a>.transform.translation.x - l_f_tf.transform.translation.x;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      tf_diff.translation.y =</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a>.transform.translation.y - l_f_tf.transform.translation.y;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      tf_diff.translation.z =</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a>.transform.translation.z - l_f_tf.transform.translation.z;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l_f_tf.transform.translation.z &gt; r_f_tf.transform.translation.z) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      dy = yqr_ - yqr; <span class="comment">// Right Foot Down</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      tf_diff.translation.x =</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a>.transform.translation.x - r_f_tf.transform.translation.x;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      tf_diff.translation.y =</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a>.transform.translation.y - r_f_tf.transform.translation.y;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      tf_diff.translation.z =</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a>.transform.translation.z - r_f_tf.transform.translation.z;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      dy = ((yql_ - yql) + (yqr_ - yqr)) / 2; <span class="comment">// Both Feet Down, take average</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      tf_diff.translation.x =</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        ((<a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a>.transform.translation.x - l_f_tf.transform.translation.x) +</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;         (<a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a>.transform.translation.x - r_f_tf.transform.translation.x)) / 2;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      tf_diff.translation.y =</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        ((<a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a>.transform.translation.y - l_f_tf.transform.translation.y) +</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;         (<a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a>.transform.translation.y - r_f_tf.transform.translation.y)) / 2;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      tf_diff.translation.z =</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        ((<a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a>.transform.translation.z - l_f_tf.transform.translation.z) +</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;         (<a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a>.transform.translation.z - r_f_tf.transform.translation.z)) / 2;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <a class="code" href="classMartyCore.html#a01535561b0d865288d1a373533428f24">l_f_tf_</a> = l_f_tf; <a class="code" href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">r_f_tf_</a> = r_f_tf;   <span class="comment">// Update feet tfs for next step</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <a class="code" href="classMartyCore.html#a00713605d98340a788fd794b7fbdaaec">y_</a> += dy;   <span class="comment">// Update Yaw and Translation Odometry estimates</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.transform.translation.x +=</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      (tf_diff.translation.x * cos(-<a class="code" href="classMartyCore.html#a00713605d98340a788fd794b7fbdaaec">y_</a>)) + (tf_diff.translation.y * sin(-<a class="code" href="classMartyCore.html#a00713605d98340a788fd794b7fbdaaec">y_</a>));</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.transform.translation.y +=</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      (tf_diff.translation.y * cos(-<a class="code" href="classMartyCore.html#a00713605d98340a788fd794b7fbdaaec">y_</a>)) + (tf_diff.translation.x * -sin(-<a class="code" href="classMartyCore.html#a00713605d98340a788fd794b7fbdaaec">y_</a>));</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.transform.translation.z += tf_diff.translation.z;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classMartyCore.html#a0831959359817e2091dd77655ee8786d">odom_accel_</a>) {  <span class="comment">// Combine Accelerometer data</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <a class="code" href="classMartyCore.html#a8fd28822869c5bc6fa1b6f5db1a343ec">quat_ori_</a>.setRPY(<a class="code" href="classMartyCore.html#a960fa5065af2a989b7f39490a47b26e9">r_</a>, <a class="code" href="classMartyCore.html#a832e744ed239de665b785622da4336fa">p_</a>, <a class="code" href="classMartyCore.html#a00713605d98340a788fd794b7fbdaaec">y_</a>); <a class="code" href="classMartyCore.html#a8fd28822869c5bc6fa1b6f5db1a343ec">quat_ori_</a>.normalize();</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    } <span class="keywordflow">else</span> {  <span class="comment">// Use only estimated Yaw</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <a class="code" href="classMartyCore.html#a8fd28822869c5bc6fa1b6f5db1a343ec">quat_ori_</a>.setRPY(0, 0, <a class="code" href="classMartyCore.html#a00713605d98340a788fd794b7fbdaaec">y_</a>); <a class="code" href="classMartyCore.html#a8fd28822869c5bc6fa1b6f5db1a343ec">quat_ori_</a>.normalize();</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.transform.rotation = tf2::toMsg(<a class="code" href="classMartyCore.html#a8fd28822869c5bc6fa1b6f5db1a343ec">quat_ori_</a>);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;}</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno"><a class="line" href="classMartyCore.html#a1ba0bea97457c3cb514c462fcf81a3eb">  409</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a1ba0bea97457c3cb514c462fcf81a3eb">MartyCore::tfCB</a>(<span class="keyword">const</span> ros::TimerEvent&amp; e) {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="comment">// Publish Joint States</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>.header.stamp = ros::Time::now(); <a class="code" href="classMartyCore.html#ac3ee562efa2d9947fe52fa6e41882e46">joints_pub_</a>.publish(<a class="code" href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">joints_</a>);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classMartyCore.html#a9e6b5e5dec6b2ee889c7286ec5a92368">camera_</a>) {  <span class="comment">// Camera transformation</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <a class="code" href="classMartyCore.html#aace8edc342f8cdcca08045db36218e1e">cam_tf_</a>.header.stamp = ros::Time::now(); <a class="code" href="classMartyCore.html#a44dcc4d97351afb80d9bafda2494ef49">tf_br_</a>.sendTransform(<a class="code" href="classMartyCore.html#aace8edc342f8cdcca08045db36218e1e">cam_tf_</a>);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="comment">// Odometry transformation</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  this-&gt;<a class="code" href="classMartyCore.html#a12582aea20cab6ff1e6290d64fd817f7">updateOdom</a>();</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>.header.stamp = ros::Time::now(); <a class="code" href="classMartyCore.html#ae1bf4b370a5a3c83f4308eb1947e716f">odom_br_</a>.sendTransform(<a class="code" href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">odom_tf_</a>);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;}</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno"><a class="line" href="classMartyCore.html#a45675e6f09c9c1fe614fafa52e5a2744">  427</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a45675e6f09c9c1fe614fafa52e5a2744">MartyCore::loadSound</a>(std::string sound_name) {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  std::ifstream soundFile;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  std::string path = ros::package::getPath(<span class="stringliteral">&quot;ros_marty&quot;</span>);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  soundFile.open(path + <span class="stringliteral">&quot;/cfg/sounds/&quot;</span> + sound_name + <span class="stringliteral">&quot;.csv&quot;</span>);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">if</span> (soundFile.is_open()) {</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    marty_msgs::SoundArray sound_array;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    marty_msgs::Sound sound;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    std::string line; <span class="keywordtype">char</span> c = <span class="charliteral">&#39;,&#39;</span>; <span class="comment">// Comma delimmited</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">while</span> (std::getline(soundFile, line)) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      std::istringstream iss(line);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keywordtype">float</span> f1, f2, t;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="keywordflow">if</span> (!(iss &gt;&gt; f1 &gt;&gt; c &gt;&gt; f2 &gt;&gt; c &gt;&gt; t)) { ROS_ERROR(<span class="stringliteral">&quot;FILE ERROR&quot;</span>); <span class="keywordflow">break</span>;}</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      sound.freq1 = f1; sound.freq2 = f2; sound.duration = t;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      sound_array.sound.push_back(sound);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    }</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    this-&gt;<a class="code" href="classMartyCore.html#a4d9e7e9c087360b9cc338cadc14f1b9c">playSoundArray</a>(sound_array);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    soundFile.close();</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    ROS_ERROR_STREAM(<span class="stringliteral">&quot;COULD NOT OPEN FILE: &quot;</span> &lt;&lt; sound_name &lt;&lt; <span class="stringliteral">&quot;.csv&quot;</span>);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno"><a class="line" href="classMartyCore.html#aafda8d93a59e223865910bad218d80a1">  449</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#aafda8d93a59e223865910bad218d80a1">MartyCore::readySound</a>() {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  this-&gt;<a class="code" href="classMartyCore.html#a45675e6f09c9c1fe614fafa52e5a2744">loadSound</a>(<span class="stringliteral">&quot;ready&quot;</span>);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;}</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno"><a class="line" href="classMartyCore.html#adae64b7e3d2b5a878979cc88dd947e48">  453</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#adae64b7e3d2b5a878979cc88dd947e48">MartyCore::celebSound</a>(<span class="keywordtype">float</span> sound_time) {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordtype">float</span> short_s = sound_time / 28;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordtype">float</span> long_s = short_s * 4;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordtype">float</span> vlong_s = short_s * 12;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  marty_msgs::SoundArray sound_array;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  marty_msgs::Sound sound;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  sound.freq1 = <a class="code" href="definitions_8hpp.html#af71ac5d772736db7a12fd9f9521dd475">NOTE_G5</a>; sound.freq2 = <a class="code" href="definitions_8hpp.html#af71ac5d772736db7a12fd9f9521dd475">NOTE_G5</a>; sound.duration = long_s;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  sound.freq1 = <a class="code" href="definitions_8hpp.html#aac1866175a2578574fc07c16e566c4fc">SILENCE</a>; sound.freq2 = <a class="code" href="definitions_8hpp.html#aac1866175a2578574fc07c16e566c4fc">SILENCE</a>; sound.duration = short_s;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  sound.freq1 = <a class="code" href="definitions_8hpp.html#af71ac5d772736db7a12fd9f9521dd475">NOTE_G5</a>; sound.freq2 = <a class="code" href="definitions_8hpp.html#af71ac5d772736db7a12fd9f9521dd475">NOTE_G5</a>; sound.duration = short_s;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  sound.freq1 = <a class="code" href="definitions_8hpp.html#aac1866175a2578574fc07c16e566c4fc">SILENCE</a>; sound.freq2 = <a class="code" href="definitions_8hpp.html#aac1866175a2578574fc07c16e566c4fc">SILENCE</a>; sound.duration = short_s;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  sound.freq1 = <a class="code" href="definitions_8hpp.html#af71ac5d772736db7a12fd9f9521dd475">NOTE_G5</a>; sound.freq2 = <a class="code" href="definitions_8hpp.html#af71ac5d772736db7a12fd9f9521dd475">NOTE_G5</a>; sound.duration = short_s;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  sound.freq1 = <a class="code" href="definitions_8hpp.html#aac1866175a2578574fc07c16e566c4fc">SILENCE</a>; sound.freq2 = <a class="code" href="definitions_8hpp.html#aac1866175a2578574fc07c16e566c4fc">SILENCE</a>; sound.duration = short_s;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  sound.freq1 = <a class="code" href="definitions_8hpp.html#a54087ffb7da518f038a39025b2a9ee7e">NOTE_C6</a>; sound.freq2 = <a class="code" href="definitions_8hpp.html#a54087ffb7da518f038a39025b2a9ee7e">NOTE_C6</a>; sound.duration = long_s;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  sound.freq1 = <a class="code" href="definitions_8hpp.html#aac1866175a2578574fc07c16e566c4fc">SILENCE</a>; sound.freq2 = <a class="code" href="definitions_8hpp.html#aac1866175a2578574fc07c16e566c4fc">SILENCE</a>; sound.duration = short_s;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  sound.freq1 = <a class="code" href="definitions_8hpp.html#af71ac5d772736db7a12fd9f9521dd475">NOTE_G5</a>; sound.freq2 = <a class="code" href="definitions_8hpp.html#af71ac5d772736db7a12fd9f9521dd475">NOTE_G5</a>; sound.duration = short_s;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  sound.freq1 = <a class="code" href="definitions_8hpp.html#aac1866175a2578574fc07c16e566c4fc">SILENCE</a>; sound.freq2 = <a class="code" href="definitions_8hpp.html#aac1866175a2578574fc07c16e566c4fc">SILENCE</a>; sound.duration = short_s;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  sound.freq1 = <a class="code" href="definitions_8hpp.html#a54087ffb7da518f038a39025b2a9ee7e">NOTE_C6</a>; sound.freq2 = <a class="code" href="definitions_8hpp.html#a54087ffb7da518f038a39025b2a9ee7e">NOTE_C6</a>; sound.duration = vlong_s;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  this-&gt;<a class="code" href="classMartyCore.html#a4d9e7e9c087360b9cc338cadc14f1b9c">playSoundArray</a>(sound_array);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno"><a class="line" href="classMartyCore.html#a8a527c3c93c3ef8896c8372d46c425a1">  484</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a8a527c3c93c3ef8896c8372d46c425a1">MartyCore::playSound</a>(<span class="keywordtype">float</span> frequency, <span class="keywordtype">float</span> duration, <span class="keywordtype">float</span> freq2) {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="keywordflow">if</span> (freq2 == -1) {freq2 = frequency;} <span class="comment">// Disable chirp</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  marty_msgs::Sound sound;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  sound.freq1 = frequency; sound.freq2 = freq2; sound.duration = duration;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  marty_msgs::SoundArray sound_array;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <a class="code" href="classMartyCore.html#ab3d4002b1add339bd53373ea115a544f">sound_pub_</a>.publish(sound_array);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;}</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno"><a class="line" href="classMartyCore.html#a4d9e7e9c087360b9cc338cadc14f1b9c">  493</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a4d9e7e9c087360b9cc338cadc14f1b9c">MartyCore::playSoundArray</a>(marty_msgs::SoundArray sound_array) {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> s = 0; s &lt; (sound_array.sound.size() / 8); ++s) {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    marty_msgs::SoundArray sounds;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = (0 + (s * 8)); i &lt; (8 + (s * 8)); ++i) {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      sounds.sound.push_back(sound_array.sound[i]);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="classMartyCore.html#ab3d4002b1add339bd53373ea115a544f">sound_pub_</a>.publish(sounds);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  }</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  marty_msgs::SoundArray sounds;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (sound_array.sound.size() % 8); ++i) {</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    sounds.sound.push_back(</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      sound_array.sound[i + (sound_array.sound.size() / 8) * 8]);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <a class="code" href="classMartyCore.html#ab3d4002b1add339bd53373ea115a544f">sound_pub_</a>.publish(sounds);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;}</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno"><a class="line" href="classMartyCore.html#a15871276b63f74d4db79e73f7f0ca115">  509</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a15871276b63f74d4db79e73f7f0ca115">MartyCore::stopSound</a>() {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  marty_msgs::Sound sound;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  sound.freq1 = 0; sound.freq2 = sound.freq1; sound.duration = 0;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  marty_msgs::SoundArray sound_array;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  sound_array.sound.push_back(sound);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <a class="code" href="classMartyCore.html#ab3d4002b1add339bd53373ea115a544f">sound_pub_</a>.publish(sound_array);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;}</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno"><a class="line" href="classMartyCore.html#a0ff05da27b07ec9f5796262be735df11">  517</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a0ff05da27b07ec9f5796262be735df11">MartyCore::loadKeyframes</a>(std::string keyframes_name, <span class="keywordtype">int</span> move_time) {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  std::ifstream keyframeFile;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  std::string path = ros::package::getPath(<span class="stringliteral">&quot;ros_marty&quot;</span>);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  keyframeFile.open(path + <span class="stringliteral">&quot;/cfg/keyframes/&quot;</span> + keyframes_name + <span class="stringliteral">&quot;.csv&quot;</span>);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordflow">if</span> (keyframeFile.is_open()) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordtype">float</span> total_time = 0; std::string line; <span class="keywordtype">char</span> c = <span class="charliteral">&#39;,&#39;</span>; <span class="comment">// Comma delimmited</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">while</span> (std::getline(keyframeFile, line)) {</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      std::istringstream iss(line);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="keywordtype">float</span> t;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="keywordflow">if</span> (!(iss &gt;&gt; t)) {ROS_ERROR(<span class="stringliteral">&quot;NO T DATA&quot;</span>); <span class="keywordflow">break</span>;}</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="comment">// ROS_WARN_STREAM(&quot;TIME: &quot; &lt;&lt; t);</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      total_time = t;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    }</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordtype">float</span> new_time = (float)move_time / 1000.0;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">if</span> (move_time == 0) { new_time = total_time; } <span class="comment">// Use Keyframe duration</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="comment">// ROS_WARN_STREAM(&quot;NEW_TIME: &quot; &lt;&lt; new_time);</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    keyframeFile.clear();</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    keyframeFile.seekg(0, std::ios::beg);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    marty_msgs::KeyframeArray k_a;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">while</span> (std::getline(keyframeFile, line)) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      std::istringstream iss(line);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      marty_msgs::Keyframe k;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keywordflow">if</span> (!(iss &gt;&gt; k.time)) {ROS_ERROR(<span class="stringliteral">&quot;NO KT DATA&quot;</span>); <span class="keywordflow">break</span>;} <span class="comment">// Get Keyframe time</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      k.time = k.time * (new_time / total_time);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      marty_msgs::ServoMsgArray s_a;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      marty_msgs::ServoMsg s;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordtype">int</span>  id, cmd;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">while</span> (iss &gt;&gt; c &gt;&gt; <span class="keywordtype">id</span> &gt;&gt; c &gt;&gt; cmd) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        s.servo_id = id; s.servo_cmd = cmd;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="comment">// ROS_WARN_STREAM(&quot;ID: &quot; &lt;&lt; id &lt;&lt; &quot; CMD: &quot; &lt;&lt; cmd);</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        s_a.servo_msg.push_back(s);</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      k.servo_array = s_a;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      k_a.keyframe.push_back(k);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    this-&gt;<a class="code" href="classMartyCore.html#a326a0d6b8446f44b25245900a73bab4b">sendKeyframes</a>(k_a);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    keyframeFile.close();</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    ROS_WARN_STREAM(<span class="stringliteral">&quot;COULD NOT OPEN FILE: &quot;</span> &lt;&lt; keyframes_name &lt;&lt; <span class="stringliteral">&quot;.csv&quot;</span>);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;}</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno"><a class="line" href="classMartyCore.html#a326a0d6b8446f44b25245900a73bab4b">  559</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a326a0d6b8446f44b25245900a73bab4b">MartyCore::sendKeyframes</a>(marty_msgs::KeyframeArray k_array) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <a class="code" href="classMartyCore.html#af65a15e9e21bfaeb740c156f27a70620">keyframe_pub_</a>.publish(k_array);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;}</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno"><a class="line" href="classMartyCore.html#a173e6a37e8eeb3ef9dcf3c2cbe5a18e2">  563</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classMartyCore.html#a173e6a37e8eeb3ef9dcf3c2cbe5a18e2">MartyCore::jointPosToServoCmd</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">float</span> pos) {</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="keywordtype">float</span> cmd = float(<a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[<span class="keywordtype">id</span>].cmdZero) +</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;              (pos * <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[id].<a class="code" href="structrobotJoint.html#a7df20835058396b9ddf84bfc038109f3">cmdMult</a> * float(<a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[<span class="keywordtype">id</span>].cmdDir));</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  cmd = fmin(cmd, <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[<span class="keywordtype">id</span>].cmdMax); cmd = fmax(cmd, <a class="code" href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">joint_</a>[<span class="keywordtype">id</span>].cmdMin);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">return</span> int(cmd);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;}</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno"><a class="line" href="classMartyCore.html#a31e0a0232409d64e8f12ffa6430c0a21">  570</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a31e0a0232409d64e8f12ffa6430c0a21">MartyCore::setServoJointPos</a>(std::string name, <span class="keywordtype">int</span> pos) {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordflow">try</span> {<a class="code" href="classMartyCore.html#af3734851891777e8bcddd864cbb44f9e">servo_msg_</a>.servo_id = <a class="code" href="definitions_8hpp.html#af552455badeb8fcc8d0be76c8123ea76">JOINT_NAMES</a>.at(name);}</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {std::cerr &lt;&lt; e.what();};</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <a class="code" href="classMartyCore.html#af3734851891777e8bcddd864cbb44f9e">servo_msg_</a>.servo_cmd = pos;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <a class="code" href="classMartyCore.html#aa50e0c51c26d4c5ef5e3c2afe419ad8b">servo_pub_</a>.publish(<a class="code" href="classMartyCore.html#af3734851891777e8bcddd864cbb44f9e">servo_msg_</a>);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  ros::spinOnce();</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;}</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno"><a class="line" href="classMartyCore.html#a148586bb7ba3c058603b130c2ac6ce5d">  578</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a148586bb7ba3c058603b130c2ac6ce5d">MartyCore::setServoPos</a>(<span class="keywordtype">int</span> channel, <span class="keywordtype">int</span> pos) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <a class="code" href="classMartyCore.html#af3734851891777e8bcddd864cbb44f9e">servo_msg_</a>.servo_id = channel;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <a class="code" href="classMartyCore.html#af3734851891777e8bcddd864cbb44f9e">servo_msg_</a>.servo_cmd = pos;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <a class="code" href="classMartyCore.html#aa50e0c51c26d4c5ef5e3c2afe419ad8b">servo_pub_</a>.publish(<a class="code" href="classMartyCore.html#af3734851891777e8bcddd864cbb44f9e">servo_msg_</a>);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;}</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno"><a class="line" href="classMartyCore.html#a4066fc0ce1f417392f88f08fe9c19d27">  584</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a4066fc0ce1f417392f88f08fe9c19d27">MartyCore::enableRobot</a>() {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <a class="code" href="classMartyCore.html#a87e8f70a443141aec8c53599af660f12">enable_robot_</a>.data = <span class="keyword">true</span>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <a class="code" href="classMartyCore.html#a3b349c5b7db6f13f7df3695c05fc4bf5">enable_pub_</a>.publish(<a class="code" href="classMartyCore.html#a87e8f70a443141aec8c53599af660f12">enable_robot_</a>);</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;}</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno"><a class="line" href="classMartyCore.html#ad2ebd3e535dc9487a285b9242aedcd81">  589</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#ad2ebd3e535dc9487a285b9242aedcd81">MartyCore::stopRobot</a>() {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <a class="code" href="classMartyCore.html#a87e8f70a443141aec8c53599af660f12">enable_robot_</a>.data = <span class="keyword">false</span>;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <a class="code" href="classMartyCore.html#a3b349c5b7db6f13f7df3695c05fc4bf5">enable_pub_</a>.publish(<a class="code" href="classMartyCore.html#a87e8f70a443141aec8c53599af660f12">enable_robot_</a>);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;}</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno"><a class="line" href="classMartyCore.html#a612e279b097cf7b3bacb59d0d4f5dea1">  594</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classMartyCore.html#a612e279b097cf7b3bacb59d0d4f5dea1">MartyCore::setServo</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">float</span> angle) {</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="keywordflow">if</span> (id &lt; 0 || id &gt;= <a class="code" href="definitions_8hpp.html#a0a9c281eff44a3c24d869735fedb0781ab24edcb61693657713c2e9299b34c539">NUMJOINTS</a>) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <a class="code" href="classMartyCore.html#af3734851891777e8bcddd864cbb44f9e">servo_msg_</a>.servo_id = id;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <a class="code" href="classMartyCore.html#af3734851891777e8bcddd864cbb44f9e">servo_msg_</a>.servo_cmd = <a class="code" href="classMartyCore.html#a173e6a37e8eeb3ef9dcf3c2cbe5a18e2">jointPosToServoCmd</a>(<span class="keywordtype">id</span>, angle);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <a class="code" href="classMartyCore.html#aa50e0c51c26d4c5ef5e3c2afe419ad8b">servo_pub_</a>.publish(<a class="code" href="classMartyCore.html#af3734851891777e8bcddd864cbb44f9e">servo_msg_</a>);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  ros::spinOnce();</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <a class="code" href="classMartyCore.html#abe0ff63291fd97b0536a510250f38868">jangles_</a>[id] = angle;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;}</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno"><a class="line" href="classMartyCore.html#a075bb36b257426f6118a9dee944ae583">  604</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classMartyCore.html#a075bb36b257426f6118a9dee944ae583">MartyCore::setServos</a>(std::map&lt;int, float&gt; angles) {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  marty_msgs::ServoMsgArray servo_msg_array;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keywordflow">for</span> (std::map&lt;int, float&gt;::iterator i = angles.begin(); i != angles.end();</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;       ++i) {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    marty_msgs::ServoMsg servo_msg;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    servo_msg.servo_id = i-&gt;first;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    servo_msg.servo_cmd = <a class="code" href="classMartyCore.html#a173e6a37e8eeb3ef9dcf3c2cbe5a18e2">jointPosToServoCmd</a>(i-&gt;first, i-&gt;second);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    servo_msg_array.servo_msg.push_back(servo_msg);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <a class="code" href="classMartyCore.html#abe0ff63291fd97b0536a510250f38868">jangles_</a>[i-&gt;first] = angles.at(i-&gt;first);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <a class="code" href="classMartyCore.html#a22fba082d2cb7bb78a1d2f108aa3e25c">servo_array_pub_</a>.publish(servo_msg_array);</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  ros::spinOnce();</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;}</div><div class="ttc" id="classMartyCore_html_ae1bf4b370a5a3c83f4308eb1947e716f"><div class="ttname"><a href="classMartyCore.html#ae1bf4b370a5a3c83f4308eb1947e716f">MartyCore::odom_br_</a></div><div class="ttdeci">tf2_ros::TransformBroadcaster odom_br_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00298">marty_core.hpp:298</a></div></div>
<div class="ttc" id="classMartyCore_html_a075bb36b257426f6118a9dee944ae583"><div class="ttname"><a href="classMartyCore.html#a075bb36b257426f6118a9dee944ae583">MartyCore::setServos</a></div><div class="ttdeci">void setServos(std::map&lt; int, float &gt; angles)</div><div class="ttdoc">Actuates multiple servos. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00604">marty_core.cpp:604</a></div></div>
<div class="ttc" id="classMartyCore_html_adc2b3c6b57e48bdd03831d1d33f3ed8c"><div class="ttname"><a href="classMartyCore.html#adc2b3c6b57e48bdd03831d1d33f3ed8c">MartyCore::jointsCB</a></div><div class="ttdeci">void jointsCB(const marty_msgs::ServoMsgArray::ConstPtr &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00196">marty_core.cpp:196</a></div></div>
<div class="ttc" id="classMartyCore_html_a730729a9e6d909aa7fc74753a969ca85"><div class="ttname"><a href="classMartyCore.html#a730729a9e6d909aa7fc74753a969ca85">MartyCore::keyframe_sub_</a></div><div class="ttdeci">ros::Subscriber keyframe_sub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00288">marty_core.hpp:288</a></div></div>
<div class="ttc" id="classMartyCore_html_a15871276b63f74d4db79e73f7f0ca115"><div class="ttname"><a href="classMartyCore.html#a15871276b63f74d4db79e73f7f0ca115">MartyCore::stopSound</a></div><div class="ttdeci">void stopSound()</div><div class="ttdoc">Stops playing sound. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00509">marty_core.cpp:509</a></div></div>
<div class="ttc" id="classMartyCore_html_a31e0a0232409d64e8f12ffa6430c0a21"><div class="ttname"><a href="classMartyCore.html#a31e0a0232409d64e8f12ffa6430c0a21">MartyCore::setServoJointPos</a></div><div class="ttdeci">void setServoJointPos(std::string name, int pos)</div><div class="ttdoc">Sets the position of a joint, using its name. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00570">marty_core.cpp:570</a></div></div>
<div class="ttc" id="classMartyCore_html_a3355cd1d38cff41b1548915bb698bac4"><div class="ttname"><a href="classMartyCore.html#a3355cd1d38cff41b1548915bb698bac4">MartyCore::getBattery</a></div><div class="ttdeci">float getBattery()</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00202">marty_core.cpp:202</a></div></div>
<div class="ttc" id="classMartyCore_html_ada9568d3e37b1ddb430ea3de6ed19d42"><div class="ttname"><a href="classMartyCore.html#ada9568d3e37b1ddb430ea3de6ed19d42">MartyCore::kfCB</a></div><div class="ttdeci">void kfCB(const std_msgs::String::ConstPtr &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00236">marty_core.hpp:236</a></div></div>
<div class="ttc" id="classMartyCore_html_abe0ff63291fd97b0536a510250f38868"><div class="ttname"><a href="classMartyCore.html#abe0ff63291fd97b0536a510250f38868">MartyCore::jangles_</a></div><div class="ttdeci">std::deque&lt; float &gt; jangles_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00223">marty_core.hpp:223</a></div></div>
<div class="ttc" id="classMartyCore_html_a9e6b5e5dec6b2ee889c7286ec5a92368"><div class="ttname"><a href="classMartyCore.html#a9e6b5e5dec6b2ee889c7286ec5a92368">MartyCore::camera_</a></div><div class="ttdeci">bool camera_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00255">marty_core.hpp:255</a></div></div>
<div class="ttc" id="classMartyCore_html_a173e6a37e8eeb3ef9dcf3c2cbe5a18e2"><div class="ttname"><a href="classMartyCore.html#a173e6a37e8eeb3ef9dcf3c2cbe5a18e2">MartyCore::jointPosToServoCmd</a></div><div class="ttdeci">int jointPosToServoCmd(int id, float pos)</div><div class="ttdoc">Desired joint position conversion. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00563">marty_core.cpp:563</a></div></div>
<div class="ttc" id="classMartyCore_html_a0ddba4390f6f72838371329f8930b5d1"><div class="ttname"><a href="classMartyCore.html#a0ddba4390f6f72838371329f8930b5d1">MartyCore::sound_sub_</a></div><div class="ttdeci">ros::Subscriber sound_sub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00287">marty_core.hpp:287</a></div></div>
<div class="ttc" id="classMartyCore_html_aace8edc342f8cdcca08045db36218e1e"><div class="ttname"><a href="classMartyCore.html#aace8edc342f8cdcca08045db36218e1e">MartyCore::cam_tf_</a></div><div class="ttdeci">geometry_msgs::TransformStamped cam_tf_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00302">marty_core.hpp:302</a></div></div>
<div class="ttc" id="classMartyCore_html_ac18a5847558bf4d8811eb2d7e171bda0"><div class="ttname"><a href="classMartyCore.html#ac18a5847558bf4d8811eb2d7e171bda0">MartyCore::battCB</a></div><div class="ttdeci">void battCB(const std_msgs::Float32::ConstPtr &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00310">marty_core.cpp:310</a></div></div>
<div class="ttc" id="structrobotJoint_html_a59c532bd7710ffeee599810b7f533e7d"><div class="ttname"><a href="structrobotJoint.html#a59c532bd7710ffeee599810b7f533e7d">robotJoint::cmdZero</a></div><div class="ttdeci">int cmdZero</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00049">marty_core.hpp:49</a></div></div>
<div class="ttc" id="classMartyCore_html_ac3ee562efa2d9947fe52fa6e41882e46"><div class="ttname"><a href="classMartyCore.html#ac3ee562efa2d9947fe52fa6e41882e46">MartyCore::joints_pub_</a></div><div class="ttdeci">ros::Publisher joints_pub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00279">marty_core.hpp:279</a></div></div>
<div class="ttc" id="classMartyCore_html_a6ed602bfc9baa24621d794976a8c3369"><div class="ttname"><a href="classMartyCore.html#a6ed602bfc9baa24621d794976a8c3369">MartyCore::fall_dis_srv_</a></div><div class="ttdeci">ros::ServiceServer fall_dis_srv_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00290">marty_core.hpp:290</a></div></div>
<div class="ttc" id="classMartyCore_html_ad3d16ea1a8bf2cdaafd368b48e494a1c"><div class="ttname"><a href="classMartyCore.html#ad3d16ea1a8bf2cdaafd368b48e494a1c">MartyCore::fall_disable_</a></div><div class="ttdeci">bool fall_disable_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00250">marty_core.hpp:250</a></div></div>
<div class="ttc" id="classMartyCore_html_a9a67293317df40afa0e29b0f3a6d97f6"><div class="ttname"><a href="classMartyCore.html#a9a67293317df40afa0e29b0f3a6d97f6">MartyCore::falling_pub_</a></div><div class="ttdeci">ros::Publisher falling_pub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00276">marty_core.hpp:276</a></div></div>
<div class="ttc" id="classMartyCore_html_ace7942c9f2f0467b9c6daf246c7fa5dd"><div class="ttname"><a href="classMartyCore.html#ace7942c9f2f0467b9c6daf246c7fa5dd">MartyCore::gpio_sub_</a></div><div class="ttdeci">ros::Subscriber gpio_sub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00286">marty_core.hpp:286</a></div></div>
<div class="ttc" id="classMartyCore_html_a969c290f3d5ade57a90f7c2aadf875e6"><div class="ttname"><a href="classMartyCore.html#a969c290f3d5ade57a90f7c2aadf875e6">MartyCore::setFallDetector</a></div><div class="ttdeci">bool setFallDetector(std_srvs::SetBool::Request &amp;req, std_srvs::SetBool::Response &amp;res)</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00144">marty_core.cpp:144</a></div></div>
<div class="ttc" id="definitions_8hpp_html_a0374cad637bd9df09182785b0c204658"><div class="ttname"><a href="definitions_8hpp.html#a0374cad637bd9df09182785b0c204658">WARN</a></div><div class="ttdeci">#define WARN(x)</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8hpp_source.html#l00022">definitions.hpp:22</a></div></div>
<div class="ttc" id="classMartyCore_html_a84e5c247edc904e7fe0095baafd982f3"><div class="ttname"><a href="classMartyCore.html#a84e5c247edc904e7fe0095baafd982f3">MartyCore::yaw_</a></div><div class="ttdeci">std::deque&lt; double &gt; yaw_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00267">marty_core.hpp:267</a></div></div>
<div class="ttc" id="classMartyCore_html_a622ac5d29c8e0bc5ad96b15a72befe0a"><div class="ttname"><a href="classMartyCore.html#a622ac5d29c8e0bc5ad96b15a72befe0a">MartyCore::roll_</a></div><div class="ttdeci">std::deque&lt; double &gt; roll_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00265">marty_core.hpp:265</a></div></div>
<div class="ttc" id="classMartyCore_html_a832e744ed239de665b785622da4336fa"><div class="ttname"><a href="classMartyCore.html#a832e744ed239de665b785622da4336fa">MartyCore::p_</a></div><div class="ttdeci">double p_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00295">marty_core.hpp:295</a></div></div>
<div class="ttc" id="marty__core_8hpp_html"><div class="ttname"><a href="marty__core_8hpp.html">marty_core.hpp</a></div><div class="ttdoc">Marty Core header providing access to Marty methods. </div></div>
<div class="ttc" id="definitions_8hpp_html_af71ac5d772736db7a12fd9f9521dd475"><div class="ttname"><a href="definitions_8hpp.html#af71ac5d772736db7a12fd9f9521dd475">NOTE_G5</a></div><div class="ttdeci">#define NOTE_G5</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8hpp_source.html#l00171">definitions.hpp:171</a></div></div>
<div class="ttc" id="classMartyCore_html_a97403bfc03ee9e4e7720bab246b0672b"><div class="ttname"><a href="classMartyCore.html#a97403bfc03ee9e4e7720bab246b0672b">MartyCore::simulated_</a></div><div class="ttdeci">bool simulated_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00253">marty_core.hpp:253</a></div></div>
<div class="ttc" id="classMartyCore_html_ada2c86bdec6f1e3ffcf0614853663fb2"><div class="ttname"><a href="classMartyCore.html#ada2c86bdec6f1e3ffcf0614853663fb2">MartyCore::gpioCB</a></div><div class="ttdeci">void gpioCB(const marty_msgs::GPIOs::ConstPtr &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00314">marty_core.cpp:314</a></div></div>
<div class="ttc" id="classMartyCore_html_aafda8d93a59e223865910bad218d80a1"><div class="ttname"><a href="classMartyCore.html#aafda8d93a59e223865910bad218d80a1">MartyCore::readySound</a></div><div class="ttdeci">void readySound()</div><div class="ttdoc">Plays the &quot;ready&quot; sound. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00449">marty_core.cpp:449</a></div></div>
<div class="ttc" id="classMartyCore_html_ae58a40e24bd1f3afbc121bdb9b9ae941"><div class="ttname"><a href="classMartyCore.html#ae58a40e24bd1f3afbc121bdb9b9ae941">MartyCore::battery_min_</a></div><div class="ttdeci">float battery_min_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00263">marty_core.hpp:263</a></div></div>
<div class="ttc" id="classMartyCore_html_a43ab11707929dafc889e8b62a207c141"><div class="ttname"><a href="classMartyCore.html#a43ab11707929dafc889e8b62a207c141">MartyCore::r_f_tf_</a></div><div class="ttdeci">geometry_msgs::TransformStamped r_f_tf_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00305">marty_core.hpp:305</a></div></div>
<div class="ttc" id="classMartyCore_html_a710ab72c1b1a49ce08b705fcfb394758"><div class="ttname"><a href="classMartyCore.html#a710ab72c1b1a49ce08b705fcfb394758">MartyCore::~MartyCore</a></div><div class="ttdeci">~MartyCore()</div><div class="ttdoc">Object destructor, deletes /marty param and ~ from the NodeHandle. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00018">marty_core.cpp:18</a></div></div>
<div class="ttc" id="definitions_8hpp_html_a0a9c281eff44a3c24d869735fedb0781ab24edcb61693657713c2e9299b34c539"><div class="ttname"><a href="definitions_8hpp.html#a0a9c281eff44a3c24d869735fedb0781ab24edcb61693657713c2e9299b34c539">NUMJOINTS</a></div><div class="ttdef"><b>Definition:</b> <a href="definitions_8hpp_source.html#l00041">definitions.hpp:41</a></div></div>
<div class="ttc" id="definitions_8hpp_html_aba0d904fc027cae3c83978c277181f4e"><div class="ttname"><a href="definitions_8hpp.html#aba0d904fc027cae3c83978c277181f4e">NAMES</a></div><div class="ttdeci">const std::vector&lt; std::string &gt; NAMES</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8hpp_source.html#l00044">definitions.hpp:44</a></div></div>
<div class="ttc" id="classMartyCore_html_a7d984d7fdf74ef81f23829c596949af4"><div class="ttname"><a href="classMartyCore.html#a7d984d7fdf74ef81f23829c596949af4">MartyCore::loadParams</a></div><div class="ttdeci">void loadParams()</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00023">marty_core.cpp:23</a></div></div>
<div class="ttc" id="classMartyCore_html_ab33c93f4a6092943aa806b916da79024"><div class="ttname"><a href="classMartyCore.html#ab33c93f4a6092943aa806b916da79024">MartyCore::batt_sub_</a></div><div class="ttdeci">ros::Subscriber batt_sub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00285">marty_core.hpp:285</a></div></div>
<div class="ttc" id="classMartyCore_html_a90c78210333e09fc2b2fa30b435f492e"><div class="ttname"><a href="classMartyCore.html#a90c78210333e09fc2b2fa30b435f492e">MartyCore::MartyCore</a></div><div class="ttdeci">MartyCore(ros::NodeHandle &amp;nh)</div><div class="ttdoc">Object constructor, handles initialisations. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00011">marty_core.cpp:11</a></div></div>
<div class="ttc" id="classMartyCore_html_a4112ff7fbbda7e868e095f8eac226c58"><div class="ttname"><a href="classMartyCore.html#a4112ff7fbbda7e868e095f8eac226c58">MartyCore::updateJointState</a></div><div class="ttdeci">void updateJointState(marty_msgs::ServoMsg servo)</div><div class="ttdoc">Updates the joint state positions of every joint given servo cmds. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00215">marty_core.cpp:215</a></div></div>
<div class="ttc" id="classMartyCore_html_a326a0d6b8446f44b25245900a73bab4b"><div class="ttname"><a href="classMartyCore.html#a326a0d6b8446f44b25245900a73bab4b">MartyCore::sendKeyframes</a></div><div class="ttdeci">void sendKeyframes(marty_msgs::KeyframeArray k_array)</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00559">marty_core.cpp:559</a></div></div>
<div class="ttc" id="classMartyCore_html_af4e1abfe2cecfcab9bc256cd4d583389"><div class="ttname"><a href="classMartyCore.html#af4e1abfe2cecfcab9bc256cd4d583389">MartyCore::nh_</a></div><div class="ttdeci">ros::NodeHandle nh_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00059">marty_core.hpp:59</a></div></div>
<div class="ttc" id="classMartyCore_html_ad2ebd3e535dc9487a285b9242aedcd81"><div class="ttname"><a href="classMartyCore.html#ad2ebd3e535dc9487a285b9242aedcd81">MartyCore::stopRobot</a></div><div class="ttdeci">void stopRobot()</div><div class="ttdoc">Disables Marty&amp;#39;s servos. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00589">marty_core.cpp:589</a></div></div>
<div class="ttc" id="classMartyCore_html_af2ae942aed2014564c7ef4ff046f5266"><div class="ttname"><a href="classMartyCore.html#af2ae942aed2014564c7ef4ff046f5266">MartyCore::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00062">marty_core.cpp:62</a></div></div>
<div class="ttc" id="classMartyCore_html_a2771c0b4165fd4022717fdb057f5d40b"><div class="ttname"><a href="classMartyCore.html#a2771c0b4165fd4022717fdb057f5d40b">MartyCore::falling_</a></div><div class="ttdeci">std_msgs::Bool falling_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00260">marty_core.hpp:260</a></div></div>
<div class="ttc" id="classMartyCore_html_a45675e6f09c9c1fe614fafa52e5a2744"><div class="ttname"><a href="classMartyCore.html#a45675e6f09c9c1fe614fafa52e5a2744">MartyCore::loadSound</a></div><div class="ttdeci">void loadSound(std::string sound_name)</div><div class="ttdoc">Loads sound file and if well-formed plays it. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00427">marty_core.cpp:427</a></div></div>
<div class="ttc" id="classMartyCore_html_ad022d0cf8b5da097766fbb217571bfe6"><div class="ttname"><a href="classMartyCore.html#ad022d0cf8b5da097766fbb217571bfe6">MartyCore::odom_tf_</a></div><div class="ttdeci">geometry_msgs::TransformStamped odom_tf_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00303">marty_core.hpp:303</a></div></div>
<div class="ttc" id="classMartyCore_html_a3b349c5b7db6f13f7df3695c05fc4bf5"><div class="ttname"><a href="classMartyCore.html#a3b349c5b7db6f13f7df3695c05fc4bf5">MartyCore::enable_pub_</a></div><div class="ttdeci">ros::Publisher enable_pub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00275">marty_core.hpp:275</a></div></div>
<div class="ttc" id="classMartyCore_html_a622d785e9b07add001429d3e7af6ee60"><div class="ttname"><a href="classMartyCore.html#a622d785e9b07add001429d3e7af6ee60">MartyCore::rosSetup</a></div><div class="ttdeci">void rosSetup()</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00103">marty_core.cpp:103</a></div></div>
<div class="ttc" id="classMartyCore_html_a1ba0bea97457c3cb514c462fcf81a3eb"><div class="ttname"><a href="classMartyCore.html#a1ba0bea97457c3cb514c462fcf81a3eb">MartyCore::tfCB</a></div><div class="ttdeci">void tfCB(const ros::TimerEvent &amp;e)</div><div class="ttdoc">Publishes TF and joint states on a timer callback. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00409">marty_core.cpp:409</a></div></div>
<div class="ttc" id="classMartyCore_html_a7462781d92ba61c2d7f913e88a177d26"><div class="ttname"><a href="classMartyCore.html#a7462781d92ba61c2d7f913e88a177d26">MartyCore::battery_val_</a></div><div class="ttdeci">float battery_val_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00261">marty_core.hpp:261</a></div></div>
<div class="ttc" id="classMartyCore_html_a3511e234a07c60ce506430553631e1ac"><div class="ttname"><a href="classMartyCore.html#a3511e234a07c60ce506430553631e1ac">MartyCore::odom_setup_</a></div><div class="ttdeci">bool odom_setup_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00247">marty_core.hpp:247</a></div></div>
<div class="ttc" id="classMartyCore_html_a4066fc0ce1f417392f88f08fe9c19d27"><div class="ttname"><a href="classMartyCore.html#a4066fc0ce1f417392f88f08fe9c19d27">MartyCore::enableRobot</a></div><div class="ttdeci">void enableRobot()</div><div class="ttdoc">Enables Marty&amp;#39;s servos. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00584">marty_core.cpp:584</a></div></div>
<div class="ttc" id="classMartyCore_html_a8d373cff0b0fc4516b785e1084738793"><div class="ttname"><a href="classMartyCore.html#a8d373cff0b0fc4516b785e1084738793">MartyCore::camera_ori_</a></div><div class="ttdeci">double camera_ori_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00256">marty_core.hpp:256</a></div></div>
<div class="ttc" id="classMartyCore_html_aea46deb1912ea3c7016513ac87e1bb6a"><div class="ttname"><a href="classMartyCore.html#aea46deb1912ea3c7016513ac87e1bb6a">MartyCore::soundCB</a></div><div class="ttdeci">void soundCB(const std_msgs::String::ConstPtr &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00233">marty_core.hpp:233</a></div></div>
<div class="ttc" id="classMartyCore_html_a01535561b0d865288d1a373533428f24"><div class="ttname"><a href="classMartyCore.html#a01535561b0d865288d1a373533428f24">MartyCore::l_f_tf_</a></div><div class="ttdeci">geometry_msgs::TransformStamped l_f_tf_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00304">marty_core.hpp:304</a></div></div>
<div class="ttc" id="classMartyCore_html_a612e279b097cf7b3bacb59d0d4f5dea1"><div class="ttname"><a href="classMartyCore.html#a612e279b097cf7b3bacb59d0d4f5dea1">MartyCore::setServo</a></div><div class="ttdeci">bool setServo(int id, float angle)</div><div class="ttdoc">Actuates a servo. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00594">marty_core.cpp:594</a></div></div>
<div class="ttc" id="classMartyCore_html_ae06f951948eac84ba0b33ace95b90eb8"><div class="ttname"><a href="classMartyCore.html#ae06f951948eac84ba0b33ace95b90eb8">MartyCore::joint_sub_</a></div><div class="ttdeci">ros::Subscriber joint_sub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00282">marty_core.hpp:282</a></div></div>
<div class="ttc" id="definitions_8hpp_html_aac1866175a2578574fc07c16e566c4fc"><div class="ttname"><a href="definitions_8hpp.html#aac1866175a2578574fc07c16e566c4fc">SILENCE</a></div><div class="ttdeci">#define SILENCE</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8hpp_source.html#l00114">definitions.hpp:114</a></div></div>
<div class="ttc" id="classMartyCore_html_a981ceda4f125a5f5f3ec44f5c5f30e1b"><div class="ttname"><a href="classMartyCore.html#a981ceda4f125a5f5f3ec44f5c5f30e1b">MartyCore::gpios_val_</a></div><div class="ttdeci">marty_msgs::GPIOs gpios_val_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00264">marty_core.hpp:264</a></div></div>
<div class="ttc" id="classMartyCore_html_a49d020abd66e2cdf04ff1286ec91aaec"><div class="ttname"><a href="classMartyCore.html#a49d020abd66e2cdf04ff1286ec91aaec">MartyCore::setupOdometry</a></div><div class="ttdeci">void setupOdometry()</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00184">marty_core.cpp:184</a></div></div>
<div class="ttc" id="classMartyCore_html_a22fba082d2cb7bb78a1d2f108aa3e25c"><div class="ttname"><a href="classMartyCore.html#a22fba082d2cb7bb78a1d2f108aa3e25c">MartyCore::servo_array_pub_</a></div><div class="ttdeci">ros::Publisher servo_array_pub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00278">marty_core.hpp:278</a></div></div>
<div class="ttc" id="definitions_8hpp_html_a3a7b2585d8f81aa095ef413b539cfb18"><div class="ttname"><a href="definitions_8hpp.html#a3a7b2585d8f81aa095ef413b539cfb18">sleepms</a></div><div class="ttdeci">void sleepms(int ms)</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8hpp_source.html#l00027">definitions.hpp:27</a></div></div>
<div class="ttc" id="classMartyCore_html_af3734851891777e8bcddd864cbb44f9e"><div class="ttname"><a href="classMartyCore.html#af3734851891777e8bcddd864cbb44f9e">MartyCore::servo_msg_</a></div><div class="ttdeci">marty_msgs::ServoMsg servo_msg_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00271">marty_core.hpp:271</a></div></div>
<div class="ttc" id="structrobotJoint_html_a7df20835058396b9ddf84bfc038109f3"><div class="ttname"><a href="structrobotJoint.html#a7df20835058396b9ddf84bfc038109f3">robotJoint::cmdMult</a></div><div class="ttdeci">float cmdMult</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00053">marty_core.hpp:53</a></div></div>
<div class="ttc" id="classMartyCore_html_a8a527c3c93c3ef8896c8372d46c425a1"><div class="ttname"><a href="classMartyCore.html#a8a527c3c93c3ef8896c8372d46c425a1">MartyCore::playSound</a></div><div class="ttdeci">void playSound(float frequency, float duration, float freq2=-1)</div><div class="ttdoc">Plays a frequency range. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00484">marty_core.cpp:484</a></div></div>
<div class="ttc" id="definitions_8hpp_html_a830e8fd7a64314a844902b690f4cda58"><div class="ttname"><a href="definitions_8hpp.html#a830e8fd7a64314a844902b690f4cda58">ERR</a></div><div class="ttdeci">#define ERR(x)</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8hpp_source.html#l00021">definitions.hpp:21</a></div></div>
<div class="ttc" id="classMartyCore_html_a12582aea20cab6ff1e6290d64fd817f7"><div class="ttname"><a href="classMartyCore.html#a12582aea20cab6ff1e6290d64fd817f7">MartyCore::updateOdom</a></div><div class="ttdeci">void updateOdom()</div><div class="ttdoc">This function updates the Odometry given Marty&amp;#39;s motion and sensors. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00324">marty_core.cpp:324</a></div></div>
<div class="ttc" id="classMartyCore_html_af9b5e13dd3179bd4c14a37f682fc8ea0"><div class="ttname"><a href="classMartyCore.html#af9b5e13dd3179bd4c14a37f682fc8ea0">MartyCore::tf_timer_</a></div><div class="ttdeci">ros::Timer tf_timer_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00301">marty_core.hpp:301</a></div></div>
<div class="ttc" id="classMartyCore_html_aa0027c4e6584c1b0db6295216b93d919"><div class="ttname"><a href="classMartyCore.html#aa0027c4e6584c1b0db6295216b93d919">MartyCore::jointCB</a></div><div class="ttdeci">void jointCB(const marty_msgs::ServoMsg::ConstPtr &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00192">marty_core.cpp:192</a></div></div>
<div class="ttc" id="classMartyCore_html_ae50a753181398deb70477884f868b772"><div class="ttname"><a href="classMartyCore.html#ae50a753181398deb70477884f868b772">MartyCore::setupJointStates</a></div><div class="ttdeci">void setupJointStates()</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00149">marty_core.cpp:149</a></div></div>
<div class="ttc" id="classMartyCore_html_aa50e0c51c26d4c5ef5e3c2afe419ad8b"><div class="ttname"><a href="classMartyCore.html#aa50e0c51c26d4c5ef5e3c2afe419ad8b">MartyCore::servo_pub_</a></div><div class="ttdeci">ros::Publisher servo_pub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00277">marty_core.hpp:277</a></div></div>
<div class="ttc" id="classMartyCore_html_ab3d4002b1add339bd53373ea115a544f"><div class="ttname"><a href="classMartyCore.html#ab3d4002b1add339bd53373ea115a544f">MartyCore::sound_pub_</a></div><div class="ttdeci">ros::Publisher sound_pub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00280">marty_core.hpp:280</a></div></div>
<div class="ttc" id="classMartyCore_html_ac644846686545827cfbb0ff129d2ba0e"><div class="ttname"><a href="classMartyCore.html#ac644846686545827cfbb0ff129d2ba0e">MartyCore::calibrated_</a></div><div class="ttdeci">bool calibrated_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00246">marty_core.hpp:246</a></div></div>
<div class="ttc" id="classMartyCore_html_af65a15e9e21bfaeb740c156f27a70620"><div class="ttname"><a href="classMartyCore.html#af65a15e9e21bfaeb740c156f27a70620">MartyCore::keyframe_pub_</a></div><div class="ttdeci">ros::Publisher keyframe_pub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00281">marty_core.hpp:281</a></div></div>
<div class="ttc" id="definitions_8hpp_html_af552455badeb8fcc8d0be76c8123ea76"><div class="ttname"><a href="definitions_8hpp.html#af552455badeb8fcc8d0be76c8123ea76">JOINT_NAMES</a></div><div class="ttdeci">const std::map&lt; std::string, int &gt; JOINT_NAMES</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8hpp_source.html#l00086">definitions.hpp:86</a></div></div>
<div class="ttc" id="classMartyCore_html_a0ff05da27b07ec9f5796262be735df11"><div class="ttname"><a href="classMartyCore.html#a0ff05da27b07ec9f5796262be735df11">MartyCore::loadKeyframes</a></div><div class="ttdeci">void loadKeyframes(std::string keyframes_name, int move_time=0)</div><div class="ttdoc">Parses servo keyframe file and if well-formed, publishes keyframes to be to be executed. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00517">marty_core.cpp:517</a></div></div>
<div class="ttc" id="classMartyCore_html_a00713605d98340a788fd794b7fbdaaec"><div class="ttname"><a href="classMartyCore.html#a00713605d98340a788fd794b7fbdaaec">MartyCore::y_</a></div><div class="ttdeci">double y_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00295">marty_core.hpp:295</a></div></div>
<div class="ttc" id="classMartyCore_html_a1257013e79001c4bb7386ade675ed880"><div class="ttname"><a href="classMartyCore.html#a1257013e79001c4bb7386ade675ed880">MartyCore::accelCB</a></div><div class="ttdeci">void accelCB(const marty_msgs::Accelerometer::ConstPtr &amp;msg)</div><div class="ttdoc">Accelerometer data callback. Accelerometer data used to detect falls and for walking odometry...</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00276">marty_core.cpp:276</a></div></div>
<div class="ttc" id="classMartyCore_html_a1b9fc2545c5e69fa6d0a957cae3db884"><div class="ttname"><a href="classMartyCore.html#a1b9fc2545c5e69fa6d0a957cae3db884">MartyCore::joints_sub_</a></div><div class="ttdeci">ros::Subscriber joints_sub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00283">marty_core.hpp:283</a></div></div>
<div class="ttc" id="classMartyCore_html_a148586bb7ba3c058603b130c2ac6ce5d"><div class="ttname"><a href="classMartyCore.html#a148586bb7ba3c058603b130c2ac6ce5d">MartyCore::setServoPos</a></div><div class="ttdeci">void setServoPos(int channel, int pos)</div><div class="ttdoc">Sets the position of a servo, using its ID number. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00578">marty_core.cpp:578</a></div></div>
<div class="ttc" id="classMartyCore_html_a4d9e7e9c087360b9cc338cadc14f1b9c"><div class="ttname"><a href="classMartyCore.html#a4d9e7e9c087360b9cc338cadc14f1b9c">MartyCore::playSoundArray</a></div><div class="ttdeci">void playSoundArray(marty_msgs::SoundArray sound_array)</div><div class="ttdoc">Plays a sequence of tones. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00493">marty_core.cpp:493</a></div></div>
<div class="ttc" id="classMartyCore_html_ab28ec1b5b94312417bb4c89fc3b609f4"><div class="ttname"><a href="classMartyCore.html#ab28ec1b5b94312417bb4c89fc3b609f4">MartyCore::tf_buff_</a></div><div class="ttdeci">tf2_ros::Buffer tf_buff_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00299">marty_core.hpp:299</a></div></div>
<div class="ttc" id="classMartyCore_html_afb9c8d0875a1e1c1fec63d365e406cb7"><div class="ttname"><a href="classMartyCore.html#afb9c8d0875a1e1c1fec63d365e406cb7">MartyCore::joints_</a></div><div class="ttdeci">sensor_msgs::JointState joints_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00272">marty_core.hpp:272</a></div></div>
<div class="ttc" id="classMartyCore_html_a70698111743c869bd81d2060cdf7cb94"><div class="ttname"><a href="classMartyCore.html#a70698111743c869bd81d2060cdf7cb94">MartyCore::fall_thr_</a></div><div class="ttdeci">double fall_thr_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00251">marty_core.hpp:251</a></div></div>
<div class="ttc" id="definitions_8hpp_html_a54087ffb7da518f038a39025b2a9ee7e"><div class="ttname"><a href="definitions_8hpp.html#a54087ffb7da518f038a39025b2a9ee7e">NOTE_C6</a></div><div class="ttdeci">#define NOTE_C6</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8hpp_source.html#l00176">definitions.hpp:176</a></div></div>
<div class="ttc" id="classMartyCore_html_a44dcc4d97351afb80d9bafda2494ef49"><div class="ttname"><a href="classMartyCore.html#a44dcc4d97351afb80d9bafda2494ef49">MartyCore::tf_br_</a></div><div class="ttdeci">tf2_ros::TransformBroadcaster tf_br_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00297">marty_core.hpp:297</a></div></div>
<div class="ttc" id="classMartyCore_html_a085191b257663749e7914d39bad0b17b"><div class="ttname"><a href="classMartyCore.html#a085191b257663749e7914d39bad0b17b">MartyCore::accel_sub_</a></div><div class="ttdeci">ros::Subscriber accel_sub_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00284">marty_core.hpp:284</a></div></div>
<div class="ttc" id="classMartyCore_html_a8fd28822869c5bc6fa1b6f5db1a343ec"><div class="ttname"><a href="classMartyCore.html#a8fd28822869c5bc6fa1b6f5db1a343ec">MartyCore::quat_ori_</a></div><div class="ttdeci">tf2::Quaternion quat_ori_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00296">marty_core.hpp:296</a></div></div>
<div class="ttc" id="classMartyCore_html_a482d48aa2c5c2416cc57a872a11afc33"><div class="ttname"><a href="classMartyCore.html#a482d48aa2c5c2416cc57a872a11afc33">MartyCore::battery_max_</a></div><div class="ttdeci">float battery_max_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00262">marty_core.hpp:262</a></div></div>
<div class="ttc" id="classMartyCore_html_ad8cd107e6f053a93b0dc55477921b646"><div class="ttname"><a href="classMartyCore.html#ad8cd107e6f053a93b0dc55477921b646">MartyCore::joint_</a></div><div class="ttdeci">robotJoint joint_[NUMJOINTS]</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00222">marty_core.hpp:222</a></div></div>
<div class="ttc" id="classMartyCore_html_a3024df690641ea689cc9e4d8f11db7a7"><div class="ttname"><a href="classMartyCore.html#a3024df690641ea689cc9e4d8f11db7a7">MartyCore::accel_</a></div><div class="ttdeci">marty_msgs::Accelerometer accel_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00259">marty_core.hpp:259</a></div></div>
<div class="ttc" id="classMartyCore_html_a3c07f4cb0be587e3f6c04ed0808e2bb4"><div class="ttname"><a href="classMartyCore.html#a3c07f4cb0be587e3f6c04ed0808e2bb4">MartyCore::pitch_</a></div><div class="ttdeci">std::deque&lt; double &gt; pitch_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00266">marty_core.hpp:266</a></div></div>
<div class="ttc" id="classMartyCore_html_adae64b7e3d2b5a878979cc88dd947e48"><div class="ttname"><a href="classMartyCore.html#adae64b7e3d2b5a878979cc88dd947e48">MartyCore::celebSound</a></div><div class="ttdeci">void celebSound(float sound_time)</div><div class="ttdoc">Plays the &quot;celebration&quot; sound. </div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8cpp_source.html#l00453">marty_core.cpp:453</a></div></div>
<div class="ttc" id="classMartyCore_html_a0831959359817e2091dd77655ee8786d"><div class="ttname"><a href="classMartyCore.html#a0831959359817e2091dd77655ee8786d">MartyCore::odom_accel_</a></div><div class="ttdeci">bool odom_accel_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00252">marty_core.hpp:252</a></div></div>
<div class="ttc" id="classMartyCore_html_a87e8f70a443141aec8c53599af660f12"><div class="ttname"><a href="classMartyCore.html#a87e8f70a443141aec8c53599af660f12">MartyCore::enable_robot_</a></div><div class="ttdeci">std_msgs::Bool enable_robot_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00270">marty_core.hpp:270</a></div></div>
<div class="ttc" id="classMartyCore_html_a960fa5065af2a989b7f39490a47b26e9"><div class="ttname"><a href="classMartyCore.html#a960fa5065af2a989b7f39490a47b26e9">MartyCore::r_</a></div><div class="ttdeci">double r_</div><div class="ttdef"><b>Definition:</b> <a href="marty__core_8hpp_source.html#l00295">marty_core.hpp:295</a></div></div>
</div><!-- fragment --></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/ros_marty">ros_marty</a><br />
Author(s): Alejandro Bordallo <alex.bordallo@robotical.io></br />
<small>autogenerated on Mon Jun 19 2017 12:27:30</small>
</div>
</body>
</html>
